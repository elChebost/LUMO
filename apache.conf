# Configuración de Apache para LUMO
# Coloca este archivo en /etc/apache2/sites-available/lumo.conf
# y actívalo: sudo a2ensite lumo

<VirtualHost *:80>
    ServerName lumo.anima.edu.uy
    
    # Directorio donde se encuentran los archivos del frontend compilado
    DocumentRoot /var/www/lumo/frontend/dist
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/lumo-error.log
    CustomLog ${APACHE_LOG_DIR}/lumo-access.log combined
    
    <Directory /var/www/lumo/frontend/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Reescribir todas las rutas al index.html (para React Router)
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Proxy para las peticiones al backend API
    ProxyPreserveHost On
    ProxyPass /api http://localhost:4000/api
    ProxyPassReverse /api http://localhost:4000/api
    
    # Habilitar módulos necesarios:
    # sudo a2enmod rewrite
    # sudo a2enmod proxy
    # sudo a2enmod proxy_http
</VirtualHost>
